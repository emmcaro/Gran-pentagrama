<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <title>Exemple VexFlow GitHub Pages</title>
  <script src="https://unpkg.com/vexflow/releases/vexflow-min.js"></script>
  <style>
    body {
      background: #23243a;
      color: #f0f0f0;
      font-family: 'Poppins', sans-serif;
      text-align: center;
      padding: 30px;
    }
    #container {
      margin: auto;
      background: #292a40;
      padding: 2rem;
      border-radius: 1rem;
      width: fit-content;
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>Exemple VexFlow a GitHub Pages</h1>
    <div id="music"></div>
    <button id="new-question" style="margin-top: 20px; padding: 10px 15px; font-size: 18px; cursor:pointer;">Nova pregunta</button>
  </div>

  <script>
    const VF = Vex.Flow;
    const div = document.getElementById("music");
    let renderer, context;

    // Inicialitza el renderer i context
    function initRenderer() {
      div.innerHTML = "";
      renderer = new VF.Renderer(div, VF.Renderer.Backends.SVG);
      renderer.resize(600, 250);
      context = renderer.getContext();
    }

    // Funció que dibuixa el grand staff amb notes passades
    function drawGrandStaff(trebleNotes, bassNotes) {
      initRenderer();

      const trebleStave = new VF.Stave(40, 40, 500);
      trebleStave.addClef("treble").setContext(context).draw();

      const bassStave = new VF.Stave(40, 140, 500);
      bassStave.addClef("bass").setContext(context).draw();

      const connector = new VF.StaveConnector(trebleStave, bassStave);
      connector.setType(VF.StaveConnector.type.BRACKET);
      connector.setContext(context).draw();

      const lineConnector = new VF.StaveConnector(trebleStave, bassStave);
      lineConnector.setType(VF.StaveConnector.type.SINGLE_LEFT);
      lineConnector.setContext(context).draw();

      const voiceTreble = new VF.Voice({ num_beats: 4, beat_value: 4 });
      voiceTreble.addTickables(
        trebleNotes.map(
          note => new VF.StaveNote({ clef: "treble", keys: note, duration: "q" })
        )
      );

      const voiceBass = new VF.Voice({ num_beats: 4, beat_value: 4 });
      voiceBass.addTickables(
        bassNotes.map(
          note => new VF.StaveNote({ clef: "bass", keys: note, duration: "q" })
        )
      );

      new VF.Formatter()
        .joinVoices([voiceTreble])
        .joinVoices([voiceBass])
        .format([voiceTreble, voiceBass], 400);

      voiceTreble.draw(context, trebleStave);
      voiceBass.draw(context, bassStave);
    }

    // Funció per generar notes aleatòries a mostrar
    function showRandomNotes() {
      const treblePool = ["c/4", "d/4", "e/4", "f/4", "g/4", "a/4", "b/4", "c/5", "e/5"];
      const bassPool = ["c/2", "e/2", "g/2", "a/2", "b/2", "c/3", "e/3", "g/3"];

      // Generar 2 notes aleatòries per clau
      const randomFromPool = (pool, count) =>
        Array.from({ length: count }, () => pool[Math.floor(Math.random() * pool.length)]);

      const trebleNotes = randomFromPool(treblePool, 2);
      const bassNotes = randomFromPool(bassPool, 2);

      drawGrandStaff(trebleNotes, bassNotes);
    }

    // Inicialització
    showRandomNotes();

    document.getElementById("new-question").addEventListener("click", showRandomNotes);
  </script>
</body>
</html>
